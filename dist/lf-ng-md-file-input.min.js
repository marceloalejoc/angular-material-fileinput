!function(e,i,l){"use strict";var n=[],t=[],a=[],r=[],f=[],o=[],s=function(){return"lfobjyxxxxxxxx".replace(/[xy]/g,function(e){var i=16*Math.random()|0,l="x"==e?i:3&i|8;return l.toString(16)})},d=function(e){var i=e.type,l=e.name;return u(i,l)?"image":p(i,l)?"video":g(i,l)?"audio":m(i,l)?"pdfIE":"object"},c=function(){return navigator.userAgent.toLowerCase().indexOf("msie")>=0||navigator.userAgent.toLowerCase().indexOf("trident")>=0},u=function(e,i){return!(!e.match("image.*")&&!i.match(/\.(gif|png|jpe?g)$/i))},p=function(e,i){return!(!e.match("video.*")&&!i.match(/\.(og?|mp4|webm|3gp)$/i))},g=function(e,i){return!(!e.match("audio.*")&&!i.match(/\.(ogg|mp3|wav)$/i))},m=function(e,i){return!(!e.match("application/pdf")||!i.match(/\.(pdf)$/i))},v=function(i,l){var n={key:s(),lfFile:i,lfFileName:i.name,lfFileType:i.type,lfFileSize:parseInt(i.size/1024/1024*100)/100,lfTagType:d(i),lfDataUrl:e.URL.createObjectURL(i),lfUint8Array:l,isRemote:!1};return n},F=function(e,i,l){var n={name:i,type:l},t={key:s(),lfFile:void 0,lfFileName:i,lfFileType:l,lfTagType:d(n),lfDataUrl:e,isRemote:!0};return t},b=function(e,l,o){function s(e){var f=e.getViewport(o.scale),s=document.createElement("canvas");s.className="canvasClass",i.element(s).css("width","80%");var d=s.getContext("2d"),c={canvasContext:d,viewport:f};s.height=f.height,s.width=f.width,u.appendChild(s);var p=e.render(c);p.promise.then(function(){0===a[l.lfFileObj.key]&&(n[l.lfFileObj.key]=new jsPDF("p","pt",[s.width,s.height]),n[l.lfFileObj.key].deletePage(1),n[l.lfFileObj.key].addPage(s.width,s.height));var e=new Image;e.src=s.toDataURL("image/jpeg",1),n[l.lfFileObj.key].addImage(e.src,"jpeg",0,0,s.width,s.height),a[l.lfFileObj.key]++,a[l.lfFileObj.key]>=t[l.lfFileObj.key]?r[l.lfFileObj.key]=n[l.lfFileObj.key].output().length:n[l.lfFileObj.key].addPage(s.width,s.height)})}function d(e){a[l.lfFileObj.key]=0,t[l.lfFileObj.key]=e.numPages;for(var i=1;i<=e.numPages;i++)e.getPage(i).then(s)}var c=document.getElementById("_"+l.lfFileObj.key),u=document.getElementById("_div_"+l.lfFileObj.key);u||(u=document.createElement("div"),u.id="_div_"+l.lfFileObj.key,c.appendChild(u)),u.innerHTML="",i.element(u).bind("mousedown",function(e){var i=e.clientX||e.layerX||0,n=e.clientY||e.layerY||0;f[l.lfFileObj.key]={x:i,y:n}}),i.element(u).bind("mouseup",function(e){f[l.lfFileObj.key]=null}),i.element(u).bind("mouseout",function(e){f[l.lfFileObj.key]=null}),i.element(u).bind("mousemove",function(e){if(f[l.lfFileObj.key]&&f[l.lfFileObj.key].x){var i=e.clientX||e.layerX||0,n=e.clientY||e.layerY||0;c.scrollTop-=n-f[l.lfFileObj.key].y,c.scrollLeft-=i-f[l.lfFileObj.key].x,f[l.lfFileObj.key]={x:i,y:n}}}),o=o||{scale:1},PDFJS.disableWorker=!0,PDFJS.getDocument(e).then(d)},y=i.module("lfNgMdFileInput",["ngMaterial"]);y.directive("lfFile",function(){return{restrict:"E",scope:{lfFileObj:"=",lfUnknowClass:"="},link:function(e,i,l){var n=e.lfFileObj.lfDataUrl,t=e.lfFileObj.lfFileType,a=e.lfFileObj.lfTagType,r=e.lfUnknowClass;switch(a){case"image":i.replaceWith('<img src="'+n+'" />');break;case"video":i.replaceWith('<video controls><source src="'+n+'""></video>');break;case"audio":i.replaceWith('<audio controls><source src="'+n+'""></audio>');break;case"pdfIE":i.replaceWith('<div id="_'+e.lfFileObj.key+'" class="canvas-container"></div>'),b(e.lfFileObj.lfUint8Array,e);break;default:void 0==e.lfFileObj.lfFile&&(t="unknown/unknown"),i.replaceWith('<object type="'+t+'" data="'+n+'"><div class="lf-ng-md-file-input-preview-default"><md-icon class="lf-ng-md-file-input-preview-icon '+r+'"></md-icon></div></object>')}}}}),y.run(function(e){e.put("lfNgMdFileinput.html",['<div layout="column" class="lf-ng-md-file-input" ng-model="'+s()+'">','<div layout="column" class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':isDisabled}" ng-show="isDrag || (isPreview && lfFiles.length)">','<md-button aria-label="remove all files" class="close lf-ng-md-file-input-x" ng-click="removeAllFiles($event)" ng-hide="!lfFiles.length || !isPreview" >&times;</md-button>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="(!lfFiles.length || !isPreview) && isDrag">','<div class="lf-ng-md-file-input-drag-text">{{strCaptionDragAndDrop}}</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails" ng-if="isPreview == true">','<div class="lf-ng-md-file-input-frame" ng-repeat="lffile in lfFiles" ng-click="onFileClick(lffile)" ng-mouseover="isPdfImg(lffile.key)">','<div ng-if="lffile.lfFileSize" style="position:absolute;text-align:left;">','<div style="margin-top:-2px">','<button id="lf-zoomImgIn" ng-click="lfCanvasZoom(lffile.key,20)"></button> ','<button id="lf-zoomImgOut" ng-click="lfCanvasZoom(lffile.key,-20)"></button> ','<button id="lf-downloadImg" ng-click="savePdfImg(lffile.key)" title="{{strCaptionSaveJpgPdf}} {{toPdfImg[lffile.key]}} MiB" ng-if="toPdfImg[lffile.key]"></button> ','<span ng-if="toPdfImg[lffile.key]">&nbsp; <input type="checkbox" ng-click="sendPdfImg(lffile.key,this)" title="">{{strCaptionSendJpgPdf}} {{toPdfImg[lffile.key]}} MiB</span>',"</div>","</div>",'<div class="lf-ng-md-file-input-x" aria-label="remove {{lffile.lfFileName}}" ng-click="removeFile(lffile,$event)">&times;</div>','<lf-file lf-file-obj="lffile" lf-unknow-class="strUnknowIconCls"/>','<div class="lf-ng-md-file-input-frame-footer">','<div class="lf-ng-md-file-input-frame-caption">{{lffile.lfFileName}}</div>','<div class="lf-ng-md-file-input-frame-caption" ng-if="lffile.lfFileSize" style="width:100%">{{lffile.lfFileSize}} MiB</div>',"</div>","</div>","</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div layout="row" class="lf-ng-md-file-input-container" >','<div class="lf-ng-md-file-input-caption" layout="row" layout-align="start center" flex ng-class="{\'disabled\':isDisabled}" >','<md-icon class="lf-icon" ng-class="strCaptionIconCls"></md-icon>','<div flex class="lf-ng-md-file-input-caption-text-default" ng-show="!lfFiles.length">',"{{strCaptionPlaceholder}}","</div>",'<div flex class="lf-ng-md-file-input-caption-text" ng-hide="!lfFiles.length">','<span ng-if="isCustomCaption">{{strCaption}}</span>','<span ng-if="!isCustomCaption">','{{ lfFiles.length == 1 ? lfFiles[0].lfFileName : lfFiles.length+" files selected" }}',"</span>","</div>",'<md-progress-linear md-mode="determinate" value="{{floatProgress}}" ng-show="intLoading && isProgress"></md-progress-linear>',"</div>",'<md-button aria-label="remove all files" ng-disabled="isDisabled" ng-click="removeAllFiles()" ng-hide="!lfFiles.length || intLoading" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove" >','<md-icon class="lf-icon" ng-class="strRemoveIconCls"></md-icon> ',"{{strCaptionRemove}}","</md-button>",'<md-button ng-disabled="isDisabled" ng-click="openDialog($event, this)" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower" >','<md-icon class="lf-icon" ng-class="strBrowseIconCls"></md-icon> ',"{{strCaptionBrowse}}",'<input type="file" aria-label="{{strAriaLabel}}" accept="{{accept}}" ng-disabled="isDisabled" class="lf-ng-md-file-input-tag" />',"</md-button>","</div>","</div>"].join(""))}),y.filter("lfTrusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),y.directive("lfRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,i,l,n){n&&(n.$validators.required=function(e,i){return!!e&&e.length>0})}}}),y.directive("lfMaxcount",function(){return{restrict:"A",require:"ngModel",link:function(e,i,l,n){if(n){var t=-1;l.$observe("lfMaxcount",function(e){var i=parseInt(e,10);t=isNaN(i)?-1:i,n.$validate()}),n.$validators.maxcount=function(e,i){return!!e&&e.length<=t}}}}}),y.directive("lfFilesize",function(){return{restrict:"A",require:"ngModel",link:function(e,i,l,n){if(n){var t=-1;l.$observe("lfFilesize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var l=["Byte","KB","MB"],a=e.match(i)[1],r=e.substring(0,e.indexOf(a));l.every(function(e,i){return a!==e||(t=parseInt(r)*Math.pow(1024,i),!1)})}else t=-1;n.$validate()}),n.$validators.filesize=function(e,i){if(!e)return!1;var l=!0;return e.every(function(e,i){return!(e.lfFile.size>t)||(l=!1,!1)}),l}}}}}),y.directive("lfTotalsize",function(){return{restrict:"A",require:"ngModel",link:function(e,l,n,t){if(t){var a=-1;n.$observe("lfTotalsize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var l=["Byte","KB","MB"],n=e.match(i)[1],r=e.substring(0,e.indexOf(n));l.every(function(e,i){return n!==e||(a=parseInt(r)*Math.pow(1024,i),!1)})}else a=-1;t.$validate()}),t.$validators.totalsize=function(e,l){if(!e)return!1;var n=0;return i.forEach(e,function(e,i){n+=e.lfFile.size}),n<a}}}}}),y.directive("lfMimetype",function(){return{restrict:"A",require:"ngModel",link:function(e,i,l,n){if(n){var t;l.$observe("lfMimetype",function(e){var i=e.replace(/,/g,"|");t=new RegExp(i,"i"),n.$validate()}),n.$validators.mimetype=function(e,i){if(!e)return!1;var l=!0;return e.every(function(e,i){return!!e.lfFile.type.match(t)||(l=!1,!1)}),l}}}}}),y.directive("lfNgMdFileInput",["$q","$compile","$timeout",function(e,t,a){return{restrict:"E",templateUrl:"lfNgMdFileinput.html",replace:!0,require:"ngModel",scope:{lfFiles:"=?",lfApi:"=?",lfOption:"=?",lfCaption:"@?",lfPlaceholder:"@?",lfDragAndDropLabel:"@?",lfBrowseLabel:"@?",lfRemoveLabel:"@?",lfSaveJpgPdfLabel:"@?",lfSendJpgPdfLabel:"@?",lfOnFileClick:"=?",lfOnFileRemove:"=?",accept:"@?",ngDisabled:"=?"},link:function(t,f,s,d){var u=i.element(f[0].querySelector(".lf-ng-md-file-input-tag")),p=i.element(f[0].querySelector(".lf-ng-md-file-input-drag")),g=i.element(f[0].querySelector(".lf-ng-md-file-input-thumbnails")),m=0;t.intLoading=0,t.floatProgress=0,t.isPreview=!1,t.isDrag=!1,t.isMutiple=!1,t.isProgress=!1,t.isCustomCaption=!1,i.isDefined(s.preview)&&(t.isPreview=!0),i.isDefined(s.drag)&&(t.isDrag=!0),i.isDefined(s.multiple)?(u.attr("multiple","multiple"),t.isMutiple=!0):u.removeAttr("multiple"),i.isDefined(s.progress)&&(t.isProgress=!0),t.isDisabled=!1,i.isDefined(s.ngDisabled)&&t.$watch("ngDisabled",function(e){t.isDisabled=e}),t.strBrowseIconCls="lf-browse",t.strRemoveIconCls="lf-remove",t.strCaptionIconCls="lf-caption",t.strUnknowIconCls="lf-unknow",i.isDefined(s.lfOption)&&i.isObject(t.lfOption)&&(t.lfOption.hasOwnProperty("browseIconCls")&&(t.strBrowseIconCls=t.lfOption.browseIconCls),t.lfOption.hasOwnProperty("removeIconCls")&&(t.strRemoveIconCls=t.lfOption.removeIconCls),t.lfOption.hasOwnProperty("captionIconCls")&&(t.strCaptionIconCls=t.lfOption.captionIconCls),t.lfOption.hasOwnProperty("unknowIconCls")&&(t.strUnknowIconCls=t.lfOption.unknowIconCls)),t.accept=t.accept||"",t.lfFiles=[],t[s.ngModel]=t.lfFiles,t.lfApi=new function(){var e=this;e.removeAll=function(){t.removeAllFiles()},e.removeByName=function(e){t.removeFileByName(e)},e.addRemoteFile=function(e,i,l){var n=F(e,i,l);t.lfFiles.push(n)}},t.strCaption="",t.strCaptionPlaceholder="Select file",t.strCaptionDragAndDrop="Drag & drop files here...",t.strCaptionBrowse="Browse",t.strCaptionRemove="Remove",t.strCaptionSaveJpgPdf="Save reduced ",t.strCaptionSendJpgPdf="Send reduced ",t.strAriaLabel="",i.isDefined(s.ariaLabel)&&(t.strAriaLabel=s.ariaLabel),i.isDefined(s.lfPlaceholder)&&t.$watch("lfPlaceholder",function(e){t.strCaptionPlaceholder=e}),i.isDefined(s.lfCaption)&&(t.isCustomCaption=!0,t.$watch("lfCaption",function(e){t.strCaption=e})),t.lfDragAndDropLabel&&(t.strCaptionDragAndDrop=t.lfDragAndDropLabel),t.lfBrowseLabel&&(t.strCaptionBrowse=t.lfBrowseLabel),t.lfRemoveLabel&&(t.strCaptionRemove=t.lfRemoveLabel),t.lfSaveJpgPdfLabel&&(t.strCaptionSaveJpgPdf=t.lfSaveJpgPdfLabel),t.lfSendJpgPdfLabel&&(t.strCaptionSendJpgPdf=t.lfSendJpgPdfLabel),t.openDialog=function(e,i){e&&a(function(){e.preventDefault(),e.stopPropagation();var i=e.target.children[2];i!==l&&u[0].click()},0)},t.savePdfImg=function(e){var i=0;t.lfFiles.some(function(l,n){return i=n,l.key==e});var l=t.lfFiles[i].lfFileName.replace(".pdf","."+e)+".pdf";n[e].save(l)},t.sendPdfImg=function(e){var i=0,l=t.lfFiles.some(function(l,n){return i=n,l.key==e});if(n[e]&&l)if(t.lfFiles[i].lfFileName.indexOf("."+e+".pdf")<0){var a=t.lfFiles[i].lfFileName.replace(".pdf","."+e+".pdf");o[i]={lfFile:t.lfFiles[i].lfFile,lfFileSize:t.lfFiles[i].lfFileSize,lfFileName:t.lfFiles[i].lfFileName},t.lfFiles[i].lfFile=new File([n[e].output("blob")],a,{type:"application/pdf"}),t.lfFiles[i].lfFileSize=parseInt(r[e]/1024/1024*100)/100,t.lfFiles[i].lfFileName=a}else t.lfFiles[i].lfFile=o[i].lfFile,t.lfFiles[i].lfFileSize=o[i].lfFileSize,t.lfFiles[i].lfFileName=o[i].lfFileName},t.lfCanvasZoom=function(e,l){var n=0;t.lfFiles.some(function(i,l){return n=l,i.key==e});var a=document.getElementById("_div_"+e),r=i.element(a.children).css("width"),f=i.element(a).css("width"),o=parseInt(r.replace("%","").replace("px",""));r.indexOf("px")>=0&&(o=100*parseInt(r.replace("px",""))/parseInt(f.replace("px",""))),o+=l,10<o&&o<200&&i.element(a.children).css("width",o+"% ")},t.isPdfImg=function(e){var i=0;t.lfFiles.some(function(l,n){return i=n,l.key==e}),r[e]<=t.lfFiles[i].lfFile.size?t.toPdfImg[e]=parseInt(r[e]/1024/1024*100)/100:t.toPdfImg[e]=!1,c()&&(t.toPdfImg[e]=!1)},t.toPdfImg=[],t.removeAllFiles=function(e){t.toPdfImg=[],t.isDisabled||(t.lfFiles.length=0,g.empty(),y())},t.removeFileByName=function(e,i){t.isDisabled||(t.lfFiles.every(function(i,l){return i.lfFileName!=e||(t.lfFiles.splice(l,1),!1)}),y())},t.removeFile=function(e){t.lfFiles.every(function(l,n){return l.key!=e.key||(i.isFunction(t.lfOnFileRemove)&&t.lfOnFileRemove(l,n),t.lfFiles.splice(n,1),!1)}),y()},t.onFileClick=function(e){i.isFunction(t.lfOnFileClick)&&t.lfFiles.every(function(i,l){return i.key!=e.key||(t.lfOnFileClick(i,l),!1)})},p.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!t.isDisabled&&t.isDrag&&p.addClass("lf-ng-md-file-input-drag-hover")}),p.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!t.isDisabled&&t.isDrag&&p.removeClass("lf-ng-md-file-input-drag-hover")}),p.bind("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!t.isDisabled&&t.isDrag){p.removeClass("lf-ng-md-file-input-drag-hover"),i.isObject(e.originalEvent)&&(e=e.originalEvent);var l=e.target.files||e.dataTransfer.files,n=t.accept.replace(/,/g,"|"),a=new RegExp(n,"i"),r=[];i.forEach(l,function(e,i){e.type.match(a)&&r.push(e)}),b(r)}}),u.bind("change",function(e){var i=e.files||e.target.files;b(i)});var b=function(e){if(!(e.length<=0)){var i,l;t.lfFiles.map(function(e){return e.lfFileName});if(t.floatProgress=0,t.isMutiple)for(m=e.length,t.intLoading=m,i=0;i<e.length;i++)l=e[i],setTimeout(h(e[i]),100*i);else for(m=1,t.intLoading=m,i=0;i<e.length;i++){l=e[i],t.removeAllFiles(),h(l);break}u.val("")}},y=function(){d.$validate()},h=function(e){k(e).then(function(i){var l=new Uint8Array(i.result),n=!1;if(t.lfFiles.every(function(i,l){var t=i.lfFile;return t.name!=e.name||(t.size==e.size&&t.lastModified==e.lastModified&&(n=!0),!1)}),!n){var a=v(e,l);t.lfFiles.push(a)}0===t.intLoading&&y()},function(e){},function(e){})},k=function(i,l){var n=e.defer(),a=new FileReader;return a.onloadstart=function(){n.notify(0)},a.onload=function(e){},a.onloadend=function(e){n.resolve({index:l,result:a.result}),t.intLoading--,t.floatProgress=(m-t.intLoading)/m*100},a.onerror=function(e){n.reject(a.result),t.intLoading--,t.floatProgress=(m-t.intLoading)/m*100},a.onprogress=function(e){n.notify(e.loaded/e.total)},a.readAsArrayBuffer(i),n.promise}}}}])}(window,window.angular);